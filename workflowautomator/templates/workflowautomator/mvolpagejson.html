{% extends "base/intranet_base.html" %}
{% load wagtailcore_tags %}
{% load core_intranet_tags %}

{% block body_class %}template-{{ self.get_verbose_name|slugify }}{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'workflowautomator/mystyle.css' %}" />
{% endblock %}

{% block extra_js %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
<script src="http://malsup.github.com/jquery.form.js"></script>
<script type = "text/javascript"> 
 $(document).on('submit', '.Validate', function(e){
        e.preventDefault();
        var form = $( this );
        $.ajax({
            type:'POST',
            url:'/workflowautomator/setready/',
            data:{
                name: (form.find('input[class="name"]')).val(),
                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
            },
            success:function(){
                alert("did it");
            }
        });

 });
</script>
<!--<script type = "text/javascript">
$(document).ready(function() { /// Wait till page is loaded
    setInterval(timingLoad, 3000);
    function timingLoad() {
        $('#bigtable').load('#bigtable', function() {
/// can add another function here
});
    }
}); //// End of Wait till page is loaded
</script>-->
{% endblock %}

{% block content %}

{% for breadcrumb in breadcrumbs %}
<a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a>
{% if not forloop.last %} &gt; {% endif %}
{% endfor %}

<h1> 
    {{ name.0 }}
</h1>
<table class = "table table-hover table-sm" id = "bigtable">
    <thead>
        <tr>
            <th width= "185px">
                Name:              
            </th>
            <th>
                Last modified date:
            </th>
            {% if oneupfrombottom == True %}
            <th>
                <form class = "Validate" method = "post">
                    {% csrf_token %}
                    <input type = "text" class = "name" value = {{name.0}} style = "display:none">
                    <input type = "submit" class="btn btn-outline-primary" value = "Validate All" />
                </form>
            </th>
            {% endif %}
            <th>
                none
            </th>
            <th>
                ready
            </th>
            <th>
                queue
            </th>
            <th>
                invalid
            </th>
            <th>
                valid
            </th>
            <th>
                Last Development upload date:
            </th>
            <th>
                Development synced:
            </th>
            <th>
                Last Production upload date:
            </th>
            {% if oneupfrombottom == True %}
            <th>
                <form method = "post">
                    {% csrf_token %}
                    <input type = "submit" class="btn btn-outline-primary"  value = "Push All" />
                </form>
            </th>
            {% endif %}
            <th>
                Production synced:
            </th>
        </tr>
    </thead>
    {% for child in children %}
    <tr>
        <td style = "color:#5B8FA8">
            {% if oneupfrombottom == False %}
            <a href = "{% url 'hierarch' child.0 %}"> {{ child.0 }}</a>
            {% else %}
            {{ child.0 }}
            {% endif %}
        </td>
        <td>
            {{ child.1.owncloud.1 }}
        </td>
        {% if oneupfrombottom == True %}
        <td>
            <form class = "Validate" method = "post">
                {% csrf_token %}
                <input type = "text" class = "name" value = {{child.0}} style = "display:none">
                <input type = "submit" class="btn btn-outline-primary btn-sm" value = "Validate"/>
            </form>
        </td>
        {% endif %}
        <td align = "center" style = "background-color: #ddd">
            <p class = "tooltip">{{child.5}} <span class = "tooltiptext">none</span></p>
        </td>
        <td align = "center">
            <p class = "tooltip">{{child.6}} <span class = "tooltiptext">ready</span></p>
        </td>
        <td align = "center" style = "background-color: #ddd">
            <p class = "tooltip">{{child.7}} <span class = "tooltiptext">queue</span></p>
        </td>
        <td align = "center">
            <p class = "tooltip">{{child.8}} <span class = "tooltiptext">invalid</span></p>
        </td>
        <td align = "center" style = "background-color: #ddd">
           <p class = "tooltip">{{child.2}} <span class = "tooltiptext">valid</span></p>
        </td>
        <td>
            {% if child.1.development %}
            {{ child.1.development.1 }}
            {% else %}
            None
            {% endif %}
        </td>
        <td>
            {{ child.3 }}
        </td>
        <td>
            {% if child.1.production %}
            {{ child.1.production.1 }}
            {% else %}
            None
            {% endif %}
        </td>
        {% if oneupfrombottom == True %}
        <td>
            <form method = "post">
                {% csrf_token %}
                <input type = "submit" class="btn btn-outline-primary btn-sm" value = "Push to Production" />
            </form>
        </td>
        {% endif %}
        <td>
            {{ child.4 }}
        </td>
    </tr>
    {% endfor %}
</table>

{% endblock %}