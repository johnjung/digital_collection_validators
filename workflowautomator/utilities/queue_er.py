import re
import json
from password import ocpassword
import owncloud
import os
import requests

def filterbottom(oc, p):
    print(p)
    if re.match('mvol/\d{4}/\d{4}/\d{4}/?$', p):
        return 'IIIF_Files/' + p

def runutil(oc, file_info):
    for entry in oc.list(file_info.get_path()):
        if entry.get_name() == 'ready':
            oc.delete(entry)
            os.utime("queue")
            oc.put_file(file_info, "queue")
            break

username = "ldr_oc_admin"
password = ocpassword
oc = owncloud.Client('https://s3.lib.uchicago.edu/owncloud')
oc.login(username, password)

r = requests.get('https://www2.lib.uchicago.edu/keith/tmp/cai.json')
r = r.json()
#allreadies = r['ready']
allreadies =[
"mvol/0004/1913/0103/",
"mvol/0004/1913/0104/",
"mvol/0004/1913/0107/",
"mvol/0004/1913/0108/",
"mvol/0004/1913/0109/",
"mvol/0004/1913/0110/",
"mvol/0004/1913/0111/",
"mvol/0004/1913/0114/",
"mvol/0004/1913/0115/",
"mvol/0004/1913/0116/",
"mvol/0004/1913/0117/",
"mvol/0004/1913/0118/",
"mvol/0004/1913/0121/",
"mvol/0004/1913/0122/",
"mvol/0004/1913/0123/",
"mvol/0004/1913/0124/",
"mvol/0004/1913/0125/",
"mvol/0004/1913/0128/",
"mvol/0004/1913/0129/",
"mvol/0004/1913/0130/",
"mvol/0004/1913/0131/",
"mvol/0004/1913/0201/",
"mvol/0004/1913/0204/",
"mvol/0004/1913/0205/",
"mvol/0004/1913/0206/",
"mvol/0004/1913/0207/",
"mvol/0004/1913/0208/",
"mvol/0004/1913/0211/",
"mvol/0004/1913/0212/",
"mvol/0004/1913/0214/",
"mvol/0004/1913/0215/",
"mvol/0004/1913/0218/",
"mvol/0004/1913/0219/",
"mvol/0004/1913/0220/",
"mvol/0004/1913/0221/",
"mvol/0004/1913/0222/",
"mvol/0004/1913/0225/",
"mvol/0004/1913/0226/",
"mvol/0004/1913/0227/",
"mvol/0004/1913/0228/",
"mvol/0004/1913/0301/",
"mvol/0004/1913/0304/",
"mvol/0004/1913/0305/",
"mvol/0004/1913/0306/",
"mvol/0004/1913/0307/",
"mvol/0004/1913/0308/",
"mvol/0004/1913/0311/",
"mvol/0004/1913/0312/",
"mvol/0004/1913/0313/",
"mvol/0004/1913/0314/",
"mvol/0004/1913/0315/",
"mvol/0004/1913/0318/",
"mvol/0004/1913/0401/",
"mvol/0004/1913/0402/",
"mvol/0004/1913/0403/",
"mvol/0004/1913/0404/",
"mvol/0004/1913/0405/",
"mvol/0004/1913/0408/",
"mvol/0004/1913/0409/",
"mvol/0004/1913/0410/",
"mvol/0004/1913/0411/",
"mvol/0004/1913/0412/",
"mvol/0004/1913/0415/",
"mvol/0004/1913/0416/",
"mvol/0004/1913/0417/",
"mvol/0004/1913/0418/",
"mvol/0004/1913/0419/",
"mvol/0004/1913/0422/",
"mvol/0004/1913/0423/",
"mvol/0004/1913/0424/",
"mvol/0004/1913/0425/",
"mvol/0004/1913/0426/",
"mvol/0004/1913/0429/",
"mvol/0004/1913/0430/",
"mvol/0004/1913/0501/",
"mvol/0004/1913/0502/",
"mvol/0004/1913/0503/",
"mvol/0004/1913/0506/",
"mvol/0004/1913/0507/",
"mvol/0004/1913/0508/",
"mvol/0004/1913/0509/",
"mvol/0004/1913/0510/",
"mvol/0004/1913/0513/",
"mvol/0004/1913/0514/",
"mvol/0004/1913/0515/",
"mvol/0004/1913/0516/",
"mvol/0004/1913/0517/",
"mvol/0004/1913/0520/",
"mvol/0004/1913/0521/",
"mvol/0004/1913/0522/",
"mvol/0004/1913/0523/",
"mvol/0004/1913/0524/",
"mvol/0004/1913/0527/",
"mvol/0004/1913/0528/",
"mvol/0004/1913/0529/",
"mvol/0004/1913/0530/",
"mvol/0004/1913/0603/",
"mvol/0004/1913/0604/",
"mvol/0004/1913/0605/",
"mvol/0004/1913/0606/",
"mvol/0004/1913/0607/",
"mvol/0004/1913/0609/",
"mvol/0004/1913/0930/",
"mvol/0004/1913/1002/",
"mvol/0004/1913/1003/",
"mvol/0004/1913/1004/",
"mvol/0004/1913/1007/",
"mvol/0004/1913/1008/",
"mvol/0004/1913/1009/",
"mvol/0004/1913/1010/",
"mvol/0004/1913/1011/",
"mvol/0004/1913/1014/",
"mvol/0004/1913/1015/",
"mvol/0004/1913/1016/",
"mvol/0004/1913/1017/",
"mvol/0004/1913/1018/",
"mvol/0004/1913/1021/",
"mvol/0004/1913/1022/",
"mvol/0004/1913/1023/",
"mvol/0004/1913/1024/",
"mvol/0004/1913/1025/",
"mvol/0004/1913/1028/",
"mvol/0004/1913/1029/",
"mvol/0004/1913/1030/",
"mvol/0004/1913/1031/",
"mvol/0004/1913/1101/",
"mvol/0004/1913/1104/",
"mvol/0004/1913/1105/",
"mvol/0004/1913/1106/",
"mvol/0004/1913/1107/",
"mvol/0004/1913/1108/",
"mvol/0004/1913/1111/",
"mvol/0004/1913/1112/",
"mvol/0004/1913/1113/",
"mvol/0004/1913/1114/",
"mvol/0004/1913/1115/",
"mvol/0004/1913/1118/",
"mvol/0004/1913/1119/",
"mvol/0004/1913/1120/",
"mvol/0004/1913/1121/",
"mvol/0004/1913/1122/",
"mvol/0004/1913/1125/",
"mvol/0004/1913/1126/",
"mvol/0004/1913/1127/",
"mvol/0004/1913/1129/",
"mvol/0004/1913/1202/",
"mvol/0004/1913/1203/",
"mvol/0004/1913/1204/",
"mvol/0004/1913/1205/",
"mvol/0004/1913/1206/",
"mvol/0004/1913/1209/",
"mvol/0004/1913/1210/",
"mvol/0004/1913/1211/",
"mvol/0004/1913/1212/",
"mvol/0004/1913/1213/",
"mvol/0004/1913/1216/",
"mvol/0004/1913/1217/",
"mvol/0004/1913/1218/",
]
allreadiesfiltered = []
for rt in allreadies:
    allreadiesfiltered = allreadiesfiltered + [filterbottom(oc, rt)]

for rt in allreadiesfiltered:
    runutil(oc, oc.file_info(rt))
